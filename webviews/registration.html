<!DOCTYPE html>
<html>
<head>
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta charset="utf-8">
  <title>hoomba</title>
    <link rel="stylesheet" type="text/css" href="style.css">
</head>
<body>
  <script>
    window.fbAsyncInit = function() {
       FB.init({
         appId      : '2169355909963830',
         xfbml      : true,
         version    : 'v2.11'
       });
       FB.AppEvents.logPageView();
     };

    var user_psid;
   (function(d, s, id){
     var js, fjs = d.getElementsByTagName(s)[0];
     if (d.getElementById(id)) {return;}
     js = d.createElement(s); js.id = id;
     js.src = "https://connect.facebook.com/en_US/messenger.Extensions.js";
     fjs.parentNode.insertBefore(js, fjs);
   }(document, 'script', 'Messenger'));

   window.extAsyncInit = function () {
       var isSupported = MessengerExtensions.isInExtension();
       alert(isSupported);
       // the Messenger Extensions JS SDK is done loading
       // MessengerExtensions.requestCloseBrowser(function success() {
       //     console.log("closing success");
       // }, function error(err) {
       //     console.log("closing failure");
       //     console.log(err);
       // });
       MessengerExtensions.getContext('2169355909963830',
         function success(result){
           user_psid = result.psid;
           // alert("Success: "+ result.psid);
           console.log("Success: "+ result.psid);
         },
         function error(result){
           console.log("FAIL: " + JSON.stringify(result));
           // alert("FAIL: " + JSON.stringify(result));
         }
       );
     };
   // function windowClose() { window.open('','_parent',''); window.close();}
   function sendUserInfo(){
     console.log("USER PSID: " + user_psid);
     alert("sendUserInfo Success: " + user_psid);
     var url = process.env.HEROKU_URL + "/register/user_info";
     var messageData = { json: { "user_psid" : user_psid }};
     request.post(url, messageData,
       funtion (err, response, body) {
         if (!err && response.statusCode == 200){
           console.log(body);
         }
       }
     )
   }
  </script>
  <div class = "login-page">
    <div class = "form">
      <form class = "register-form" id = "register-form" method = "post" action="/register/new_user">
      <input name = "newRegiMajor" type="text" placeholder="전공학과"/>
      <input name = "newRegiClass" type="text" placeholder="학번"/>
      <input class = "submit" type = "submit" onclick="sendUserInfo()" value="새로 등록">
<!--       <input type="text" placeholder="기타?"/> -->
<!--       <button onclick="newRegi()">등록</button> -->
      <p class = "message">이미 등록되어 있어?
        <a href="#"> 새 정보로 다시 등록 </a>
      </p>
      </form>

      <form class="login-form" id="login-form" method = "post" action="/register/re_user">
      <input name = "reRegiMajor" type="text" placeholder="전공학과"/>
      <input name = "reRegiClass" type="text" placeholder="학번"/>
<!--       <input type="text" placeholder="기타?"/> -->
      <input class = "submit" type = "submit" onclick="sendUserInfo()" value="새정보로 다시 등록">
<!--       <button onclick="reRegi()">새정보로 다시 등록</button> -->
      <p class = "message">아직 등록 안 되어있어?
        <a href="#"> 신규 등록 </a>
      </p>
      </form>

    </div>
  </div>

  <script src="https://code.jquery.com/jquery-3.3.1.min.js"></script>
  <script>
    $('.message a').click(function(){
    $('form').animate({height: "toggle", opacity: "toggle"}, "slow")
    });
    // function newRegi(){
    //   var x = document.getElementById("register-form");
    //   var newRegiMajor = x.elements["newRegiMajor"].value;
    //   var newRegiClass = x.elements["newRegiClass"].value;
    //   //document.write(newRegiMajor +"/"+  newRegiClass);
    //   console.log("newRegiMajor: " + newRegiMajor + " / "
    //     + "newRegiClass: " + newRegiClass);
    // }
    // function reRegi(){
    //   var x = document.getElementById("login-form");
    //   var reRegiMajor = x.elements["reRegiMajor"].value;
    //   var reRegiClass = x.elements["reRegiClass"].value;
    //   //document.write(reRegiMajor +"/"+  reRegiClass);
    //   console.log("reRegiMajor: " + reRegiMajor + " / "
    //     + "reRegiClass: " + reRegiClass);
    // }
  </script>


</body>
</html>
